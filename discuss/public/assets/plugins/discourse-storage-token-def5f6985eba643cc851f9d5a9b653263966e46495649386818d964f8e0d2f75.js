define("discourse/plugins/discourse-storage-token/discourse/initializers/storage-token",["exports","ember-addons/ember-computed-decorators","discourse/lib/plugin-api"],function(e,t,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,e.default={name:"storage-token",initialize:function(e){e.lookup("site-settings:main"),e.lookup("store:main");function i(e){for(var t=0;t<e.length;t++){var o=e[t],n=document.createElement("div"),s=Math.random().toString(36).substring(7),r=document.createElement("iframe");r.setAttribute("name","external_login_frame_"+s),r.style.display="none",n.appendChild(r);var i=document.createElement("form");i.setAttribute("action",o.url),i.setAttribute("id","external_login_form_"+s),i.setAttribute("method",o.method),i.setAttribute("target","external_login_frame_"+s);for(var u=0;u<o.fields.length;u++){var a=document.createElement("input");a.setAttribute("type","hidden"),a.setAttribute("name",o.fields[u].n),a.setAttribute("value",o.fields[u].v),i.appendChild(a)}n.appendChild(i),document.body.appendChild(n),document.getElementById("external_login_form_"+s).submit(),function(e){setTimeout(function(){document.body.removeChild(e)},3e4)}(n)}}$(document).ready(function(){var r;(r=new XMLHttpRequest).open("GET","/session/current.json",!0),r.onreadystatechange=function(e){if(4==r.readyState)if(2==parseInt(r.status/100)){try{var t=JSON.parse(r.responseText)}catch(e){return void console.error("unable to parse json")}var o,n,s=[];null==t||null==t.current_user||null==t.current_user.id||null==t.current_user.custom_fields||null==t.current_user.custom_fields.storage_username||null==t.current_user.custom_fields.storage_password?console.log("not able to login on storage.confais.org"):(o=t.current_user.custom_fields.storage_username,n=t.current_user.custom_fields.storage_password,s.push({url:"https://storage.confais.org/drive/webman/login.cgi",method:"GET",fields:[{n:"username",v:o},{n:"passwd",v:n}]}),s.push({url:"https://storage.confais.org/moments/webman/login.cgi",method:"GET",fields:[{n:"username",v:o},{n:"passwd",v:n}]}),s.push({url:"https://storage.confais.org/photo/webapi/auth.php",method:"GET",fields:[{n:"api",v:"SYNO.PhotoStation.Auth"},{n:"version",v:"1"},{n:"method",v:"login"},{n:"username",v:o},{n:"password",v:n}]}),s.push({url:"https://storage.confais.org/file/webapi/auth.cgi",method:"GET",fields:[{n:"api",v:"SYNO.API.Auth"},{n:"version",v:"2"},{n:"method",v:"login"},{n:"account",v:o},{n:"passwd",v:n},{n:"session",v:"FileStation"}]})),null==t||null==t.current_user||null==t.current_user.id||null==t.current_user.custom_fields||null==t.current_user.custom_fields.genealogy_username||null==t.current_user.custom_fields.genealogy_password?console.log("not able to login on confais.org/genealogy/"):(o=t.current_user.custom_fields.genealogy_username,n=t.current_user.custom_fields.genealogy_password,s.push({url:"https://confais.org/genealogy/login.php",method:"POST",fields:[{n:"action",v:"login"},{n:"url",v:"index.php?ged=family"},{n:"username",v:o},{n:"password",v:n}]})),i(s),setInterval(function(){i([{url:"https://storage.confais.org/drive/webapi/entry.cgi",method:"GET",fields:[{n:"stop_when_error",v:"false"},{n:"mode",v:'"parallel"'},{n:"compound",v:'[{"api":"SYNO.Entry.Request","method":"request","version":1,"compound":[{"api":"SYNO.Core.Desktop.Timeout","version":1,"method":"check"}]},{"api":"SYNO.Entry.Request","method":"request","version":1,"compound":[{"api":"SYNO.Core.Desktop.Timeout","version":1,"method":"check"}]}]'},{n:"api",v:"SYNO.Entry.Request"},{n:"method",v:"request"},{n:"version",v:"1"}]}])},6e4)}else{console.error("current.json not found");i([{url:"https://storage.confais.org/drive/webman/logout.cgi",method:"GET",fields:[]},{url:"https://storage.confais.org/moments/webman/logout.cgi",method:"GET",fields:[]},{url:"https://storage.confais.org/photo/webapi/auth.php",method:"GET",fields:[{n:"api",v:"SYNO.PhotoStation.Auth"},{n:"version",v:"1"},{n:"method",v:"logout"}]},{url:"https://storage.confais.org/file/webapi/auth.cgi",method:"GET",fields:[{n:"api",v:"SYNO.API.Auth"},{n:"version",v:"2"},{n:"method",v:"logout"}]},{url:"https://confais.org/genealogy/logout.php",method:"GET",fields:[]}])}},r.send()})}}});
//# sourceMappingURL=/assets/plugins/discourse-storage-token-def5f6985eba643cc851f9d5a9b653263966e46495649386818d964f8e0d2f75.js.map